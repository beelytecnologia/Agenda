<!-- ============ LISTA ============ -->
<div *ngIf="view !== 'create'" class=" full-height">

  <!-- Header -->
  <div class="header-row">
    <div class="ghost"></div>
    <span class="title">Agendamentos</span>
    <i class="fas fa-user-tie"></i>
  </div>

  <!-- Tabs -->
  <ul class="tabs p-4" >
    <li [class.active]="tabIndex===0" (click)="tabIndex=0">Agendados</li>
    <li [class.active]="tabIndex===1" (click)="tabIndex=1">Anteriores</li>
  </ul>

  <!-- Estado vazio -->
  <div class="empty-box">
    <i class="fas fa-calendar-times big-icon"></i>
    <p>Voc√™ n√£o tem nenhum agendamento marcado</p>
  </div>

  <!-- Bot√£o -->
   <div class="p-4">  <button class="new-btn " (click)="openCreate()" >+ Novo agendamento</button>
   </div>
</div>


<div class="header-row mb-3" *ngIf="view == 'create'" style="width: 100%;">
  <button pButton icon="fas fa-arrow-left"
          class="p-button-text"
          (click)="backToList()"></button>
  <span class="title">Novo Agendamento</span>
  <i class="fas fa-user"></i> <!-- √çcone de usu√°rio alterado -->
</div>
<div *ngIf="view === 'create'" class="p-4">

  <p class="mb-4" style="font-size: small;">Selecione os detalhes do seu agendamento</p>

  <!-- FILIAL -->
  <div class="select-card" (click)="filialDlgVisible = true">
    <i class="fas fa-briefcase"></i> <!-- Exemplo de √≠cone de maleta do Font Awesome -->
    <span>{{ selectedFilial()?.nome || 'Selecione a filial' }}</span>
  </div>

  <!-- PROFISSIONAL -->
  <div class="select-card" (click)="profDlgVisible = true">
    <i class="fas fa-user"></i>
      <span>{{ selectedProf()?.nome || 'Selecione um profissional' }}</span>
  </div>

  <!-- SERVI√áOS -->
  <div class="select-card" (click)="servDlgVisible = true">
    <i class="fas fa-plus-circle"></i> <!-- √çcone alterado -->
    <span>{{ servicosLabel }}</span>
  </div>

  <!-- HOR√ÅRIO -->
  <div class="select-card" (click)="horaDlgVisible = true">
    <i class="fas fa-calendar-alt"></i> <!-- √çcone alterado -->
    <span>{{ selectedHora() || 'Selecione um hor√°rio' }}</span>
  </div>

  <!-- TOTAL -->
  <p class="mt-6" *ngIf="selectedServs().length">
    Total a pagar:
    <strong>R$ {{ totalPreco | number:'1.0-0' }},00</strong>
  </p>

  <!-- BOT√ÉO -->


</div>

<!-- ========== DIALOGOS (bottom-sheet) ========== -->

<!-- FILIAIS -->
<p-dialog [(visible)]="filialDlgVisible" modal contentStyleClass="bottom-sheet"
          [style]="{ background: 'white', padding: '15px', borderRadius: '8px', display: 'flex', flexDirection: 'column', gap: '15px', minWidth: '337px', }"
          [maskStyle]="{ 'backdrop-filter': 'blur(5px)', backgroundColor: 'rgba(0, 0, 0, 0.1)' }">
  <h3 class="text-center mb-3">Selecione uma das nossas filiais</h3>
  <ul class="select-list">
    <li *ngFor="let f of filiais()" (click)="chooseFilial(f)">
      <strong>{{ f.nome }}</strong>
      <div class="price" *ngIf="f.endereco">
        {{ f.endereco.rua }}, {{ f.endereco.numero }}
        <span *ngIf="f.endereco.complemento"> - {{ f.endereco.complemento }}</span>
      </div>
    </li>
  </ul>
</p-dialog>

<!-- PROFISSIONAIS -->
<!-- PROFISSIONAIS -->
<p-dialog [(visible)]="profDlgVisible"
          modal
          contentStyleClass="bottom-sheet"
          [style]="{ background: 'white', padding: '15px', borderRadius: '8px',
                     display: 'flex', flexDirection: 'column', gap: '15px',
                     minWidth: '337px' }"
          [maskStyle]="{ 'backdrop-filter': 'blur(5px)',
                         backgroundColor: 'rgba(0, 0, 0, 0.1)' }">

  <h3 class="text-center mb-3">Selecione o profissional</h3>

  <div class="profs-grid">
    <div *ngFor="let p of profDaFilial()" (click)="chooseProf(p)">

      <!-- imagem OU √≠cone fallback -->
      <ng-container *ngIf="p.foto; else noPic">
        <img [src]="p.foto" alt="{{ p.nome }}">
      </ng-container>

      <ng-template #noPic>
        <div class="avatar-fallback">
          <i class="fas fa-user"></i>
        </div>
      </ng-template>

      <span>{{ p.nome }}</span>
    </div>
  </div>
</p-dialog>


<!-- SERVI√áOS -->
<p-dialog [(visible)]="servDlgVisible" modal contentStyleClass="bottom-sheet"      [style]="{ background: 'white', padding: '15px', borderRadius: '8px', display: 'flex', flexDirection: 'column', gap: '15px', minWidth: '337px', }"
[maskStyle]="{ 'backdrop-filter': 'blur(5px)', backgroundColor: 'rgba(0, 0, 0, 0.1)' }">
  <h3 class="text-center mb-3">Selecione os servi√ßos</h3>

  <!-- ‚úÖ v√≠rgula removida do *ngFor  -->
  <div *ngFor="let s of servicos()" class="service-card"
       (click)="toggleServico(s)">

    <div style="position:relative">
      <strong>{{ s.nome }}</strong>
      <div class="price">R$ {{ s.preco | number:'1.0-0' }},00</div>
      <span class="tag" *ngIf="s.highlight">üî• Em alta</span>
    </div>


    <i
       [ngClass]="isServicoSelected(s) ? 'fas fa-check-circle' : 'far fa-circle'"> <!-- Classes de √≠cone alteradas -->
    </i>
  </div>

  <button pButton label="OK" class="w-full mt-3"
          (click)="servDlgVisible = false"></button>
</p-dialog>

<!-- HOR√ÅRIOS -->
<p-dialog [(visible)]="horaDlgVisible"
          modal
          contentStyleClass="bottom-sheet"
          [style]="{ background:'#fff', padding:'20px', borderRadius:'14px', width:'400px', minHeight:'300px' }"
          [maskStyle]="{ 'backdrop-filter':'blur(5px)', background:'rgba(0,0,0,.15)' }">


  <!-- =================  PASSO 1 : DATA  ================= -->
  <ng-container *ngIf="!selectedDate()">
      <div class="custom-calendar">
      <h3 class="dlg-h3">Selecione data e hora</h3>
      <div class="weekdays">
        <span *ngFor="let day of weekdays">{{ day }}</span>
      </div>
      <div class="days">
        <button *ngFor="let day of days"
                [disabled]="day.disabled"
                class="day"
                (click)="chooseDate(day.date)">
          {{ day.date.getDate() }}
        </button>
      </div>
    </div>
  </ng-container>

  <!-- =================  PASSO 2 : HOR√ÅRIOS  ============== -->
  <ng-container *ngIf="selectedDate()">
    <div class="custom-calendar">
      <h3 class="dlg-h3">Hor√°rios dispon√≠veis no dia {{ selectedDate()?.toLocaleDateString('pt-BR') }}</h3>
      <div class="slots">
        <button *ngFor="let h of horas"
                class="slot"
                [disabled]="false"
                (click)="chooseHora(h)">
          {{ h }}
        </button>
      </div>
      <ng-container *ngIf="horas.length === 0">
        <p class="text-center muted">Nenhum hor√°rio dispon√≠vel.</p>
      </ng-container>
    </div>
  </ng-container>


</p-dialog>



<button pButton label="Agendar" *ngIf="view == 'create'"
  class="w-full"
  style="position: fixed; bottom: 20px; left: 16px; right: 16px; background-color: black; color: white; height: 50px; border-radius: 10px; z-index: 1000; max-width: calc(100% - 32px); margin: 0 auto;"
  [disabled]="disabledAgendar()"
  (click)="confirm()">
</button>
